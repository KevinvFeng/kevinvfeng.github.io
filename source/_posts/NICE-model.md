---
title: NICE模型
date: 2021-06-22 20:03:54
tags:
- 
---
NICE是第一款 Flow-based 模型. Flow-based 是另一种生成模型的方法, 在后续发展中有着不输 GAN 的能力.
<!--more-->
## 基本公式推导
生成模型实际上的作用是把一个分布通过模型能够转化成另外一个分布. 比如从高斯分布出发,通过一系列的变化成真实照片的分布, 这样有了这个生成模型,我们就可以从高斯分布中 sample 出一个点,经过同样的变化,就能生成一张十分逼真的图片.
对此我们可以写出下面的公式:
$h=f(x)$ 其中 h 是转化后的结果, f 转化的函数, x 作为输入
我们假设 h 中每个component 是独立的, 这样就有:
$p_H(h) = \Pi_d p_{H_d}(h_d)$
由于 $p_X(x)$与 $p_H(h)$都是概率密度函数,其积分=1, 所以可以使用 change of variables.
> 其实这个就是换元法, y=x 如果 a=2x+1 则 y=(a-1)/2

根据 change of variables 我们能得出
$$ p_X(x)= p_H(f(x))|det\frac{\partial f(x)}{\partial x}|$$
其中的$\frac{\partial f(x)}{\partial x}$也就是f(x)的雅可比矩阵
我们另我们的 f(x)是要可逆的,理由是我们需要通过求逆的方式从 z sample 到最终的样本 x 所以就有:
$ x = f^{-1}(h)$
出于以上考虑我们需要在构建模型的时候满足两点
1. f(x) 需要好算雅可比矩阵的行列式
2. f(x) 可以求逆

先上最终解决办法: 
将 x 分成两半: x1, x2
h1 = x1
h2 = x2+m(x1)
这样一来雅可比矩阵就是分块矩阵的
1 0
X 1
h1 = x1 本身,所以雅克比就是单位矩阵
h2内部互相独立所以h2与 x2的雅克比也是单位矩阵
h2 与 x1 的雅克比比较复杂不过没有关系因为h1 与 x2 毫无关系所以为 0 这样最终行列式还是 1
之于求逆一样简单
x1' = h1
x2' = h2-m(h1)
这样的设计能够让我们的函数 m设计的非常复杂但是又不影响什么, m 不需要求逆.
但是目前有一个非常大的问题也就是, 我们的 x1这半部分根本没有变化. 对此解决办法是 我们再叠一个 block同时把 x1,x2 反过来就可以了. 由于这个m 相对来说还是比较简单的, 每一个 block 都不可能太复杂,所以我们需要很多个 block 来实现复杂的变化,从而提升生成模型的上限.
### 为何我们能想到通过这种方式进行训练
首先先考虑一个矩阵如何快速求行列式
$$\begin{vmatrix}
A&0\\
C&D 
\end{vmatrix} = |A||D|$$所以我们应该先通过分块把雅克比行列式一块变成 0 其意义就是说,x1 这部分与h2 毫无关系. 这样做的好处就是 C 可以是非常难算的值,同时我们还不用算. 至于 AD 我们需要让其 比较容易计算, 容易计算就让其相等吧,故我们得到了 h1= 1*x1, h2 = 1*x2+m 其中 m 与 x2 完全独立. m 与 x2 无关系但是 m 与 x1有关系. 在这个分块矩阵中, 我们同时满足了可以求逆的特点,所以就得到了这种方法
### 训练方法
对数似然
